<!doctype html>
<html lang="ko">

<head>
	<meta charset="utf-8">
	<title>ì£¼ê°„í€˜ìŠ¤íŠ¸</title>

	<style>
  		body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans KR", Arial, sans-serif; margin:16px; line-height:1.4;}
  		h1 { font-size:22px; text-align:center; margin-bottom:12px; }
  			.controls { display:flex; justify-content:space-between; flex-wrap:wrap; margin-bottom:16px; }
  			.progress { font-size:16px; font-weight:bold; }
  		button { padding:8px 12px; border-radius:8px; border:1px solid #ccc; background:#f6f6f6; cursor:pointer; font-size:14px; }
  		button:hover { background:#e6e6e6; }
  		section { margin-bottom:36px; }
 	 		.table-container { overflow-x:auto; border:1px solid #ddd; border-radius:8px; }
  		table { border-collapse:collapse; width:100%; min-width:600px; }
  		th, td { border:1px solid #ddd; padding:6px 8px; text-align:center; vertical-align:middle; font-size:14px; white-space:nowrap; }
  		th { background:#fafafa; position:sticky; top:0; z-index:2; }
  		input[type=checkbox] { transform:scale(1.3); cursor:pointer; }
  			.gauge-controls button { margin:0 2px; }
  			.low-runs { color:red; font-weight:bold; }
 			.reward-button { color:blue; cursor:pointer; text-decoration:underline; }
  			.reward-button:hover { text-decoration:none; color:darkblue; }
	</style>

	<script>
		function saveCheckboxes() {
  			const states = {};
  			document.querySelectorAll('input[type="checkbox"]').forEach(cb => {
    				if(cb.id) states[cb.id] = cb.checked;
  			});
  			localStorage.setItem('checkboxStates', JSON.stringify(states));
  			updateProgress();
		}

		function loadCheckboxes() {
  			const saved = JSON.parse(localStorage.getItem('checkboxStates')|| '{}');
  			document.querySelectorAll('input[type="checkbox"]').forEach(cb=>cb.checked = !!saved[cb.id]);
  			updateProgress();
		}

		function uncheckAll() {
 			document.querySelectorAll('#Sheet1 input[type="checkbox"], #Sheet3 input[type="checkbox"]').forEach(cb=>cb.checked=false);
  			document.querySelectorAll('#Sheet2 input[data-character]').forEach(cb=>cb.checked=false);
  			saveCheckboxes();
		}

		function updateProgress() {
  			const checkboxes = document.querySelectorAll('input[type="checkbox"]');
  			const checked = Array.from(checkboxes).filter(cb=>cb.checked).length;
  			const total = checkboxes.length;
  			const percent = total ? Math.round((checked/total)*100) : 0;
  			document.getElementById('progress').textContent = `ì§„í–‰ë¥ : ${checked}/${total} (${percent}%)`;
		}

		function calculateGauge(character, checkbox) {
  			let gaugeValue = parseFloat(localStorage.getItem(`gaugeValue_${character}`)||"0");
 			if(checkbox && checkbox.checked) {
    				gaugeValue += 2.0833333;
   				if(gaugeValue > 100) gaugeValue = 100;
    				gaugeValue = parseFloat(gaugeValue.toFixed(2));
   				localStorage.setItem(`gaugeValue_${character}`, gaugeValue.toString());
 			}
  			updateGaugeDisplay(character);
		}

		function resetGauge(character) {
  			localStorage.setItem(`gaugeValue_${character}`,"0");
  			updateGaugeDisplay(character);
  			updateProgress();
		}

		function adjustGauge(character, delta) {
  			let gaugeValue = parseFloat(localStorage.getItem(`gaugeValue_${character}`)||"0");
  			gaugeValue += delta;
  			if(gaugeValue > 100) gaugeValue = 100;
  			if(gaugeValue < 0) gaugeValue = 0;
  			gaugeValue = parseFloat(gaugeValue.toFixed(2));
  			localStorage.setItem(`gaugeValue_${character}`,gaugeValue.toString());
  			updateGaugeDisplay(character);
		}

		function updateGaugeDisplay(character) {
  			let gaugeValue = parseFloat(localStorage.getItem(`gaugeValue_${character}`) || "0");
  			gaugeValue = Math.min(gaugeValue, 100);
  			gaugeValue = parseFloat(gaugeValue.toFixed(2));

  			const displayValue = Number(gaugeValue); // Removes trailing zero
  			document.getElementById(`gaugeValue_${character}`).textContent = `${displayValue}%`;

  			let statusCell = document.getElementById(`gaugeStatus_${character}`);
  			let statusText = "";
  			statusCell.className = ""; // reset class

  			if (gaugeValue >= 100) {
    				statusText = `<span class="reward-button" onclick="resetGauge('${character}')">ë³´ìƒë°›ê¸°</span>`;
  			} else {
    				const remainingRuns = Math.round((100 - gaugeValue) / 2.0833333);
    				statusText = `${remainingRuns}íŒ`;

   				 // ê°•ì¡°: 3íŒ ì´í•˜ì¼ ë•Œ
    				if (remainingRuns <= 3) {
      					statusCell.classList.add("low-runs");
   				}
  			}

  			statusCell.innerHTML = statusText;
		}

		function loadGauge() {
  			['kata','ino','deme'].forEach(updateGaugeDisplay);
		}

		window.addEventListener('DOMContentLoaded', () => {
			loadCheckboxes();
			loadGauge();
			updateProgress();

			// ëª¨ë“  ì²´í¬ë°•ìŠ¤ì— ì €ì¥ ì´ë²¤íŠ¸ ì—°ê²°
			document.querySelectorAll('input[type="checkbox"]').forEach(cb => {
				cb.addEventListener('change', () => {
					saveCheckboxes();
				});
			});

			// Sheet2 ì „ìš©: gauge ê³„ì‚°ë„ ìˆ˜í–‰
			document.querySelectorAll('#Sheet2 input[type="checkbox"]').forEach(cb => {
				cb.addEventListener('change', () => {
					const char = cb.dataset.character;
					if (char && cb.checked) calculateGauge(char, cb);
				});
			});
		});
	</script>
</head>

<body>
	<h1>ì£¼ê°„í€˜ìŠ¤íŠ¸</h1>

	<div class="controls">
  		<span class="progress" id="progress">ì§„í–‰ë¥ :0/0 (0%)</span>
  		<button onclick="uncheckAll()">âœ… ì „ì²´ ì²´í¬ í•´ì œ</button>
	</div>

	<section id="Sheet1">
  		<div class="table-container">
    		<table class="dataframe">

      		<thead>
        		<tr>
				<td></td>
				<td>ë¹„ë°€ë˜ì „</td>
				<td>ì‚¬ì›</td>
				<td>ì‹¬ì—° ë ˆì´ë“œ</td>
				<td>ì„œíœ ë ˆì´ë“œ</td>
				<td>ë„ì „ëª¨ë“œ[ë¡œì˜/ë² ë¥´ë“œ]</td>
			</tr>
      		</thead>

      		<tbody>
        		<tr>
          			<td>ì•”ìŠµ(ì¹´íƒ€)</td>
          			<td rowspan="3"><input type="checkbox" id="kata_secret"></td>
          			<td><input type="checkbox" id="kata_temple"></td>
          			<td><input type="checkbox" id="kata_deep"></td>
          			<td><input type="checkbox" id="kata_serpen"></td>
          			<td><input type="checkbox" id="kata_challenge"></td>
        		</tr>
        		<tr>
          			<td>ê¹ì§ˆ(ì´ë…¸)</td>
          			<td><input type="checkbox" id="ino_temple"></td>
          			<td><input type="checkbox" id="ino_deep"></td>
          			<td><input type="checkbox" id="ino_serpen"></td>
          			<td><input type="checkbox" id="ino_challenge"></td>
        		</tr>
        		<tr>
          			<td>ìœ±(ë°ë©”)</td>
          			<td><input type="checkbox" id="deme_temple"></td>
          			<td><input type="checkbox" id="deme_deep"></td>
          			<td><input type="checkbox" id="deme_serpen"></td>
          			<td><input type="checkbox" id="deme_challenge"></td>
        		</tr>
      		</tbody>
    		</table>
  		</div>
	</section>

	<section id="Sheet2">
  		<div class="table-container">
    		<table class="dataframe">

      		<thead>
        		<tr>
				<td colspan="2"></td>
				<td>ì•”ìŠµ(ì¹´íƒ€)</td>
				<td>ê¹ì§ˆ(ì´ë…¸)</td>
				<td>ìœ±(ë°ë©”)</td>
			</tr>
      		</thead>

      		<tbody>
        		<tr>
          			<td rowspan="4">ë‘  ë ˆì´ë“œ</td>
          			<td>ì˜ˆì–¸ì˜ ì´ˆì„</td>
          			<td><input type="checkbox" id="kata_doom1" data-character="kata"></td>
          			<td><input type="checkbox" id="ino_doom1" data-character="ino"></td>
          			<td><input type="checkbox" id="deme_doom1" data-character="deme"></td>
        		</tr>
        		<tr>
          			<td>ë‚˜ì´íŠ¸ë©”ì–´: ë¦¬ì…‹ ë£¸</td>
          			<td><input type="checkbox" id="kata_doom2" data-character="kata"></td>
          			<td><input type="checkbox" id="ino_doom2" data-character="ino"></td>
          			<td><input type="checkbox" id="deme_doom2" data-character="deme"></td>
        		</tr>
        		<tr>
          			<td>ì—¬ì™•ì˜ ì•Œí˜„ì‹¤</td>
          			<td><input type="checkbox" id="kata_doom3" data-character="kata"></td>
          			<td><input type="checkbox" id="ino_doom3" data-character="ino"></td>
          			<td><input type="checkbox" id="deme_doom3" data-character="deme"></td>
        		</tr>
        		<tr>
          			<td>ì˜ë½ì˜ íƒ‘</td>
          			<td><input type="checkbox" id="kata_doom4" data-character="kata"></td>
          			<td><input type="checkbox" id="ino_doom4" data-character="ino"></td>
          			<td><input type="checkbox" id="deme_doom4" data-character="deme"></td>
        		</tr>
        		<tr>
          			<td rowspan="3">ì•¡ì„¸ì„œë¦¬</td>
          			<td>ê²Œì´ì§€</td>
          			<td id="gaugeValue_kata">0%</td>
          			<td id="gaugeValue_ino">0%</td>
          			<td id="gaugeValue_deme">0%</td>
        		</tr>
        		<tr>
          			<td>ì •ê°€</td>
          			<td id="gaugeStatus_kata"> 0íŒ</td>
          			<td id="gaugeStatus_ino"> 0íŒ</td>
          			<td id="gaugeStatus_deme"> 0íŒ</td>
        		</tr>
        		<tr class="gauge-controls">
          			<td>ì¡°ì‘</td>
          			<td>
            				<button onclick="adjustGauge('kata',2.0833333)">+</button>
            				<button onclick="adjustGauge('kata',-2.0833333)">-</button>
            				<button onclick="resetGauge('kata')">ğŸ”„</button>
          			</td>
          			<td>
            				<button onclick="adjustGauge('ino',2.0833333)">+</button>
            				<button onclick="adjustGauge('ino',-2.0833333)">-</button>
            				<button onclick="resetGauge('ino')">ğŸ”„</button>
          			</td>
          			<td>
            				<button onclick="adjustGauge('deme',2.0833333)">+</button>
            				<button onclick="adjustGauge('deme',-2.0833333)">-</button>
            				<button onclick="resetGauge('deme')">ğŸ”„</button>
          			</td>
        		</tr>
      		</tbody>
    		</table>
  		</div>
	</section>

	<section id="Sheet3">
  		<div class="table-container">
    		<table class="dataframe">
      		<thead>
        		<tr>
				<td></td>
				<td>ë¨¸í”Œë­(ë°ë©”)</td>
				<td>ê¹€ë³¶ë°¥(ë°ë©”)</td>
				<td>ê¹€ì¹˜ì°œ(ë°ë©”)</td>
				<td>ë½(ì˜¤ë§ˆ)</td>
				<td>ì‡ì¹˜(ë§¤íŒ¨)</td>
			</tr>
      		</thead>

      		<tbody>
        		<tr>
          			<td>ì‚¬ì›</td>
         		 	<td><input type="checkbox" id="muf_temple"></td>
          			<td><input type="checkbox" id="kim_temple"></td>
          			<td><input type="checkbox" id="kimchi_temple"></td>
          			<td><input type="checkbox" id="ppok_temple"></td>
          			<td><input type="checkbox" id="itch_temple"></td>
        		</tr>
      		</tbody>
    		</table>
  		</div>
	</section>

</body>
</html>
